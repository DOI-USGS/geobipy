<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installing GeoBIPy &mdash; geobipy 2.3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=67b02a41"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            geobipy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Installing GeoBIPy</a><ul>
<li><a class="reference internal" href="#installing-a-serial-version-of-geobipy">Installing a serial version of GeoBIPy</a></li>
<li><a class="reference internal" href="#installing-a-parallel-version-of-geobipy">Installing a parallel version of GeoBIPy</a><ul>
<li><a class="reference internal" href="#installing-mpi-and-mpi4py">Installing MPI and mpi4py</a><ul>
<li><a class="reference internal" href="#mpi">MPI</a></li>
<li><a class="reference internal" href="#mpi4py">mpi4py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-parallel-hdf5-and-h5py">Installing parallel HDF5 and h5py</a><ul>
<li><a class="reference internal" href="#hdf5">HDF5</a></li>
<li><a class="reference internal" href="#h5py">h5py</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#installing-the-time-domain-forward-modeller">Installing the time domain forward modeller</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#compile-the-gatdaem1d-shared-library">Compile the gatdaem1d shared library</a></li>
<li><a class="reference internal" href="#installing-the-python-bindings">Installing the Python Bindings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">geobipy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installing GeoBIPy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/content/getting_started/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installing-geobipy">
<h1>Installing GeoBIPy<a class="headerlink" href="#installing-geobipy" title="Link to this heading"></a></h1>
<p>First things first, install a Python 3.5+ distribution.  This is the minimum version that we have tested with.
You will also need to install Numpy and a Fortran compiler.</p>
<p>This package has a few requirements depending on what you wish to do with it.</p>
<p>If you require a serial version of the code, see <a class="reference internal" href="#installing-a-serial-version-of-geobipy">Installing a serial version of GeoBIPy</a>.</p>
<p>If you require an parallel implementation, you will need to install an MPI library, and Python’s mpi4py module. See <a class="reference internal" href="#installing-mpi-and-mpi4py">Installing MPI and mpi4py</a>.</p>
<p>If you require parallel file reading and writing, you will also need to install an MPI enabled HDF5 library, as well as Python’s h5py wrapper to that library. It is important to read the notes below on installing h5py on top of a parallel HDF library.  The traditional “pip install h5py” will not work correctly. See <a class="reference internal" href="#installing-parallel-hdf5-and-h5py">Installing parallel HDF5 and h5py</a> to do this correctly.</p>
<p>If you need to install the parallel IO version of the code, we would recommend that you start with a clean install of Python. This makes it easier to determine whether you have installed and linked the correct version of the parallel HDF5 library.</p>
<p>There are two versions when installing GeoBIPy, a serial version, and a parallel version. Since GeoBIPy uses a Fortran backend for forward modelling frequency domain data, you will need to have a Fortran compiler installed. Make sure that the compiler can handle derived data types since I make use of object oriented programming in Fortran.</p>
<section id="installing-a-serial-version-of-geobipy">
<h2>Installing a serial version of GeoBIPy<a class="headerlink" href="#installing-a-serial-version-of-geobipy" title="Link to this heading"></a></h2>
<p>This is the easiest installation and provides access to a serial implementation of the code.</p>
<p>Simply clone the git repository, navigate to the package folder that contains the setup.py file, and type “pip install .”</p>
<p>You should then be able to import modules from geobipy.  For this type of installation mpi will not need to be installed, and the serial version of h5py will suffice i.e. the standard “pip install h5py” is fine.  h5py will automatically be installed during the install of GeoBIPy since it is a dependency.</p>
<p><strong>Side note:</strong>  Let’s say you ran a production run on a parallel machine with MPI and parallel HDF capabilities. You generated all the results, copied them back to your local machine, and wish to make plots and images.  You will only need to install the serial version of the code on your local machine to do this.</p>
</section>
<section id="installing-a-parallel-version-of-geobipy">
<h2>Installing a parallel version of GeoBIPy<a class="headerlink" href="#installing-a-parallel-version-of-geobipy" title="Link to this heading"></a></h2>
<p>Installing the parallel version of the code is a little trickier due to the dependencies necessary between the OpenMPI and/or HDF libraries, and how Python’s mpi4py and h5py wrap around those.</p>
<section id="installing-mpi-and-mpi4py">
<h3>Installing MPI and mpi4py<a class="headerlink" href="#installing-mpi-and-mpi4py" title="Link to this heading"></a></h3>
<p>To run this code in parallel you will need both an MPI library and the python wrapper, mpi4py.  You must install MPI first before mpi4py.</p>
<section id="mpi">
<h4>MPI<a class="headerlink" href="#mpi" title="Link to this heading"></a></h4>
<p>If you are installing GeoBIPy on a parallel machine, I would think that you have access to prebuilt MPI libraries.
If you are on a local laptop, you will need to install one.</p>
</section>
<section id="mpi4py">
<h4>mpi4py<a class="headerlink" href="#mpi4py" title="Link to this heading"></a></h4>
<p>At this point, if you have an mpi4py module already installed, please remove it (you can check with “pip list”).
If you started with a clean installation you should not have to worry about this.
To test whether a new install of mpi4py will see the mpi library you have, just type “which mpicc”.
The path that you see should point to the implementation that you want mpi4py to link to.
Make sure you are about to install mpi4py to the correct python installation.
If you type ‘which python’ it should return the path to the correct python distribution.
If you are using environments, make sure you have activated the correct one.</p>
<p>Next, use “env MPICC=&lt;Your mpicc compiler&gt; python -m pip install mpi4py”.  This last option is very important, without it, pip might install its own MPI library called MPICH2.
I would try to avoid this because if you need to install the HDF5 library you will need know which directories to link to (see <a class="reference internal" href="#installing-parallel-hdf5-and-h5py">Installing parallel HDF5 and h5py</a>).</p>
<p>At the end of the day,  h5py needs to communicate with both the correct HDF5 library and mpi4py, and both of those need to communicate with the same MPI library.</p>
</section>
</section>
<section id="installing-parallel-hdf5-and-h5py">
<h3>Installing parallel HDF5 and h5py<a class="headerlink" href="#installing-parallel-hdf5-and-h5py" title="Link to this heading"></a></h3>
<p>If a parallel HDF5 library is not available, you will need to install one. First make sure you follow <a class="reference internal" href="#installing-mpi-and-mpi4py">Installing MPI and mpi4py</a> so that an MPI library is available to you. You must install a HDF5 library first before h5py.</p>
<section id="hdf5">
<h4>HDF5<a class="headerlink" href="#hdf5" title="Link to this heading"></a></h4>
<p>When you install HDF5, make sure that the correct MPI library can be seen by typing “which mpicc”.  When you configure the HDF5 library, be sure to use the –enable-parallel option.</p>
</section>
<section id="h5py">
<h4>h5py<a class="headerlink" href="#h5py" title="Link to this heading"></a></h4>
<p>Once the HDF5 library is installed you will need to install a parallel enabled <a class="reference external" href="https://github.com/h5py/h5py">h5py package</a></p>
<p>Make sure you are about to install h5py to the correct python installation.  If you type ‘which python’ it should return the path to the correct python installation.</p>
<p>First check the following</p>
<ul class="simple">
<li><p>HDF5_DIR = Get the path to the HDF5 installation.</p></li>
<li><p>Check that ‘which mpicc’ returns the correct version of an mpi enabled compiler. This needs to point to the same MPI library that mpi4py was installed on top of.</p></li>
<li><p>Do the following, replacing items in &lt; &gt; with your mpicc compiler and you HDF5 install directory.</p></li>
</ul>
<p>This will install h5py and compile the source.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;Your<span class="w"> </span>mpicc<span class="w"> </span>compiler&gt;<span class="w"> </span><span class="nv">HDF5_MPI</span><span class="o">=</span><span class="s2">&quot;ON&quot;</span><span class="w"> </span><span class="nv">HDF5_DIR</span><span class="o">=</span>&lt;Your<span class="w"> </span>HDF5_DIR&gt;<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-binary<span class="o">=</span>h5py<span class="w"> </span>h5py
</pre></div>
</div>
</section>
</section>
</section>
<section id="installing-the-time-domain-forward-modeller">
<span id="installing-time-domain-forward-modeller"></span><h2>Installing the time domain forward modeller<a class="headerlink" href="#installing-the-time-domain-forward-modeller" title="Link to this heading"></a></h2>
<p>Ross Brodie at Geoscience Australia has written a great forward modeller, gatdaem1D,  in C++ with a python interface.
You can obtain that code here at the <a class="reference external" href="https://github.com/GeoscienceAustralia/ga-aem">GA repository</a></p>
<p>Go ahead and “git clone” that repository.</p>
<p>These instructions only describe how to install Ross’ forward modeller, but it is part of a larger code base for inversion.
If you wish to install his entire package, please follow his instructions.</p>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<p>To compile his forward modeller, you will need a c++ compiler, and <a class="reference external" href="http://www.fftw.org/">FFTW</a></p>
<p>On a Mac, installing these two items is easy if you use a package manager such as <a class="reference external" href="https://brew.sh/">homebrew</a></p>
<p>If you use brew, simply do the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>gcc
brew<span class="w"> </span>install<span class="w"> </span>fftw
</pre></div>
</div>
<p>If you do not have brew, or use a package manager, you can install fftw from source instead.</p>
<p>Download fftw-3.3.7.tar.gz from the <a class="reference external" href="http://www.fftw.org/download.html">FFTW downloads</a> .</p>
<p>Untar the folder and install fftw using the following.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar<span class="w"> </span>-zxvf<span class="w"> </span>fftw-3.3.7.tar.gz
<span class="nb">cd</span><span class="w"> </span>fftw-3.3.7
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
../configure<span class="w"> </span>--prefix<span class="o">=</span>path-to-install-to/fftw-3.3.7<span class="w"> </span>--enable-threads
make
make<span class="w"> </span>install
</pre></div>
</div>
<p>where, path-to-install-to is the location where you want fftw to be installed.</p>
</section>
<section id="compile-the-gatdaem1d-shared-library">
<h3>Compile the gatdaem1d shared library<a class="headerlink" href="#compile-the-gatdaem1d-shared-library" title="Link to this heading"></a></h3>
<p>Next, within the gatdaem1d folder, navigate to the makefiles folder and modify the top part of the file “gatdaem1d_python.make” to the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SHELL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/bin/sh
.SUFFIXES:
.SUFFIXES:<span class="w"> </span>.cpp<span class="w"> </span>.o
<span class="nv">cxx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g++
<span class="nv">cxxflags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-std<span class="o">=</span>c++11<span class="w"> </span>-O3<span class="w"> </span>-Wall<span class="w"> </span>-fPIC
<span class="nv">FFTW_DIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>path-to-fftw

<span class="nv">ldflags</span><span class="w">    </span><span class="o">+=</span><span class="w"> </span>-shared
<span class="nv">bindir</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>../python/gatdaem1d

<span class="nv">srcdir</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>../src
<span class="nv">objdir</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>./obj
<span class="nv">includes</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>-I<span class="k">$(</span>srcdir<span class="k">)</span><span class="w"> </span>-I<span class="k">$(</span>FFTW_DIR<span class="k">)</span>/include
<span class="nv">libs</span><span class="w">       </span><span class="o">=</span><span class="w"> </span>-L<span class="k">$(</span>FFTW_DIR<span class="k">)</span>/lib<span class="w"> </span>-lfftw3
<span class="nv">library</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>bindir<span class="k">)</span>/gatdaem1d.so
</pre></div>
</div>
<p>You can find out where brew installed fftw by typing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>info<span class="w"> </span>fftw
</pre></div>
</div>
<p>Which may return something like “/usr/local/Cellar/fftw/3.3.5”</p>
<p>In this case, path-to-fftw is “/usr/local/Cellar/fftw/3.3.5”</p>
<p>If you installed fftw from source, then path-to-fftw is that install path.</p>
<p>Next, type the following to compile the gatdaem1d c++ code.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-f<span class="w"> </span>gatdaem1d_python.make
</pre></div>
</div>
</section>
<section id="installing-the-python-bindings">
<h3>Installing the Python Bindings<a class="headerlink" href="#installing-the-python-bindings" title="Link to this heading"></a></h3>
<p>Finally, to install the python wrapper to gatdaem1d, navigate to the python folder of the gatdaem1d repository.
Type,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>You should now have access to the time domain forward modeller within geobipy.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Leon Foks, Burke Minsley.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>